/*!
  hey, [be]Lazy.js - v1.3.1 - 2015.02.01 
  A lazy loading and multi-serving image script
  (c) Bjoern Klinggaard - @bklinggaard - http://dinbror.dk/blazy
*/
!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.Blazy=t()}(this,function(){"use strict";function e(e){if(!document.querySelectorAll){var o=document.createStyleSheet();document.querySelectorAll=function(e,t,n,r,s){for(s=document.all,t=[],e=e.replace(/\[for\b/gi,"[htmlFor").split(","),n=e.length;n--;){for(o.addRule(e[n],"k:v"),r=s.length;r--;)s[r].currentStyle.k&&t.push(s[r]);o.removeRule(0)}return t}}C=!0,g=[],w={},v=e||{},v.error=v.error||!1,v.offset=v.offset||100,v.success=v.success||!1,v.selector=v.selector||".b-lazy",v.separator=v.separator||"|",v.container=v.container?document.querySelectorAll(v.container):!1,v.errorClass=v.errorClass||"b-error",v.breakpoints=v.breakpoints||!1,v.successClass=v.successClass||"b-loaded",v.src=h=v.src||"data-src",b=window.devicePixelRatio>1,w.top=0-v.offset,w.left=0-v.offset,E=p(n,25),k=p(u,50),N=p(s,25),u(),m(v.breakpoints,function(e){return e.width>=window.screen.width?(h=e.src,!1):void 0}),t()}function t(){l(v.selector),C&&(C=!1,v.container&&m(v.container,function(e){f(e,"scroll",E)}),f(window,"resize",k),f(window,"scroll",E),v.breakpoints&&v.breakpoints.length&&f(window,"resize",N)),n()}function n(){for(var t=0;y>t;t++){var n=g[t];(i(n)||a(n))&&(e.prototype.load(n),g.splice(t,1),y--,t--)}0===y&&e.prototype.destroy()}function o(e){var t,n=document.documentElement;return t="viewport"==e?n.clientWidth:window.screen.width}function r(){for(var e,t,n,r=v.breakpoints.length-1;r>=0;r--)e=v.breakpoints[r],n=o(e.mode),n<e.width&&(t=e);return t}function s(){var n;v.breakpoints.length&&(n=r(),S&&n!=S&&(e.prototype.destroy(),setTimeout(function(){h=n.src,m(document.querySelectorAll("."+v.successClass),function(e){e.className=e.className.replace(new RegExp(v.successClass,"g"),"")}),t()},100)),S=n)}function c(e,t){if(t||e.offsetWidth>0&&e.offsetHeight>0){var n=e.getAttribute(h)||e.getAttribute(v.src);if(n){var o=n.split(v.separator),r=o[b&&o.length>1?1:0],s=new Image;s.onerror=function(){v.error&&v.error(e,"invalid"),e.className=e.className+" "+v.errorClass},s.onload=function(){"img"===e.nodeName.toLowerCase()?e.src=r:e.style.backgroundImage='url("'+r+'")',e.className=e.className+" "+v.successClass,v.success&&v.success(e)},s.src=r}else v.error&&v.error(e,"missing"),e.className=e.className+" "+v.errorClass}}function i(e){var t=e.getBoundingClientRect();return t.right>=w.left&&t.bottom>=w.top&&t.left<=w.right&&t.top<=w.bottom}function a(e){return-1!==(" "+e.className+" ").indexOf(" "+v.successClass+" ")}function l(e){var t=document.querySelectorAll(e);y=t.length;for(var n=y;n--;g.unshift(t[n]));}function u(){w.bottom=(window.innerHeight||document.documentElement.clientHeight)+v.offset,w.right=(window.innerWidth||document.documentElement.clientWidth)+v.offset}function f(e,t,n){e.attachEvent?e.attachEvent&&e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)}function d(e,t,n){e.detachEvent?e.detachEvent&&e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)}function m(e,t){if(e&&t)for(var n=e.length,o=0;n>o&&t(e[o],o)!==!1;o++);}function p(e,t){var n=0;return function(){var o=+new Date;t>o-n||(n=o,e.apply(g,arguments))}}var h,v,w,g,y,b,C,E,k,N,S;return e.prototype.revalidate=function(){t()},e.prototype.load=function(e,t){a(e)||c(e,t)},e.prototype.destroy=function(){v.container&&m(v.container,function(e){d(e,"scroll",E)}),d(window,"scroll",E),d(window,"resize",N),d(window,"resize",k),y=0,g.length=0,C=!0},e});